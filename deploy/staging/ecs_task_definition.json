{
  "family": "somleng-switch-staging",
  "networkMode": "awsvpc",
  "executionRoleArn": "arn:aws:iam::324279636507:role/somleng-switch-staging-ecsTaskExecutionRole",
  "taskRoleArn": "arn:aws:iam::324279636507:role/somleng-switch-staging-ecs-task-role",
  "requiresCompatibilities": ["EC2"],
  "containerDefinitions": [{"cpu":0,"dependsOn":[{"condition":"HEALTHY","containerName":"app"}],"environment":[],"essential":true,"image":"public.ecr.aws/somleng/somleng-switch-nginx:latest","logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":"somleng-switch-staging-nginx","awslogs-region":"ap-southeast-1","awslogs-stream-prefix":"staging"}},"mountPoints":[],"name":"nginx","portMappings":[{"containerPort":80,"hostPort":80,"protocol":"tcp"}],"volumesFrom":[]},{"cpu":0,"dependsOn":[{"condition":"HEALTHY","containerName":"freeswitch"}],"environment":[{"name":"AHN_CORE_HTTP_PORT","value":"3000"},{"name":"AHN_CORE_PORT","value":"5222"},{"name":"AHN_ENV","value":"staging"},{"name":"APP_ENV","value":"staging"},{"name":"AWS_DEFAULT_REGION","value":"ap-southeast-1"},{"name":"RACK_ENV","value":"staging"}],"essential":true,"healthCheck":{"command":["CMD-SHELL","wget --server-response --spider --quiet http://localhost:3000/health_checks 2>&1 | grep '200 OK' > /dev/null"],"interval":10,"retries":10,"timeout":5},"image":"public.ecr.aws/somleng/somleng-switch:latest","logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":"somleng-switch-staging-app","awslogs-region":"ap-southeast-1","awslogs-stream-prefix":"staging"}},"mountPoints":[],"name":"app","portMappings":[{"containerPort":3000,"hostPort":3000,"protocol":"tcp"}],"secrets":[{"name":"APP_MASTER_KEY","valueFrom":"arn:aws:ssm:ap-southeast-1:324279636507:parameter/somleng-switch.staging.application_master_key"},{"name":"AHN_CORE_PASSWORD","valueFrom":"arn:aws:ssm:ap-southeast-1:324279636507:parameter/somleng-switch.staging.rayo_password"}],"startTimeout":120,"volumesFrom":[]},{"cpu":0,"environment":[{"name":"AWS_DEFAULT_REGION","value":"ap-southeast-1"},{"name":"FS_ALTERNATIVE_RTP_IP","value":"18.141.245.230"},{"name":"FS_ALTERNATIVE_SIP_INBOUND_IP","value":"52.74.4.205"},{"name":"FS_ALTERNATIVE_SIP_OUTBOUND_IP","value":"18.141.245.230"},{"name":"FS_CACHE_DIRECTORY","value":"/cache"},{"name":"FS_EVENT_SOCKET_PORT","value":"8021"},{"name":"FS_EXTERNAL_RTP_IP","value":"13.250.230.15"},{"name":"FS_EXTERNAL_SIP_IP","value":"52.74.4.205"},{"name":"FS_LOG_DIRECTORY","value":"/cache/freeswitch/logs"},{"name":"FS_MOD_JSON_CDR_URL","value":"https://api-staging.somleng.org/services/call_data_records"},{"name":"FS_MOD_RAYO_PORT","value":"5222"},{"name":"FS_RECORDINGS_BUCKET_NAME","value":"raw-recordings-staging.somleng.org"},{"name":"FS_RECORDINGS_BUCKET_REGION","value":"ap-southeast-1"},{"name":"FS_SIP_ALTERNATIVE_PORT","value":"6080"},{"name":"FS_SIP_PORT","value":"6060"},{"name":"FS_STORAGE_DIRECTORY","value":"/cache/freeswitch/storage"},{"name":"FS_TTS_CACHE_DIRECTORY","value":"/cache/freeswitch/tts_cache"}],"essential":true,"healthCheck":{"command":["CMD-SHELL","nc -z -w 5 localhost 5222"],"interval":10,"retries":10,"timeout":5},"image":"public.ecr.aws/somleng/somleng-switch-freeswitch:latest","logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":"somleng-switch-staging-freeswitch","awslogs-region":"ap-southeast-1","awslogs-stream-prefix":"staging"}},"mountPoints":[{"containerPath":"/cache","sourceVolume":"cache"}],"name":"freeswitch","portMappings":[{"containerPort":5222,"hostPort":5222,"protocol":"tcp"},{"containerPort":6060,"hostPort":6060,"protocol":"udp"},{"containerPort":6080,"hostPort":6080,"protocol":"udp"},{"containerPort":8021,"hostPort":8021,"protocol":"tcp"}],"secrets":[{"name":"FS_MOD_RAYO_PASSWORD","valueFrom":"arn:aws:ssm:ap-southeast-1:324279636507:parameter/somleng-switch.staging.rayo_password"},{"name":"FS_MOD_JSON_CDR_PASSWORD","valueFrom":"arn:aws:ssm:ap-southeast-1:324279636507:parameter/somleng.staging.services_password"},{"name":"FS_RECORDINGS_BUCKET_ACCESS_KEY_ID","valueFrom":"arn:aws:ssm:ap-southeast-1:324279636507:parameter/somleng-switch.staging.recordings_bucket_access_key_id"},{"name":"FS_RECORDINGS_BUCKET_SECRET_ACCESS_KEY","valueFrom":"arn:aws:ssm:ap-southeast-1:324279636507:parameter/somleng-switch.staging.recordings_bucket_secret_access_key"},{"name":"FS_EVENT_SOCKET_PASSWORD","valueFrom":"arn:aws:ssm:ap-southeast-1:324279636507:parameter/somleng-switch.staging.freeswitch_event_socket_password"}],"startTimeout":120,"volumesFrom":[]},{"cpu":0,"dependsOn":[{"condition":"HEALTHY","containerName":"freeswitch"}],"environment":[{"name":"EVENT_SOCKET_HOST","value":"localhost:8021"}],"essential":false,"image":"public.ecr.aws/somleng/somleng-switch-freeswitch-event-logger:latest","logConfiguration":{"logDriver":"awslogs","options":{"awslogs-group":"somleng-switch-staging-freeswitch-event-logger","awslogs-region":"ap-southeast-1","awslogs-stream-prefix":"staging"}},"mountPoints":[],"name":"freeswitch-event-logger","portMappings":[],"secrets":[{"name":"EVENT_SOCKET_PASSWORD","valueFrom":"arn:aws:ssm:ap-southeast-1:324279636507:parameter/somleng-switch.staging.freeswitch_event_socket_password"}],"startTimeout":120,"volumesFrom":[]}],
  "memory": "1792",
  "volumes": [
    {
      "name": "cache",
      "efsVolumeConfiguration": {
        "fileSystemId": "fs-0478c3a47ef5f3c80",
        "transitEncryption": "ENABLED"
      }
    }
  ]
}
